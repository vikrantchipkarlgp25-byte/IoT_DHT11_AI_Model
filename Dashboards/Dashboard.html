<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ðŸŒ¿ Smart Nature AI Dashboard</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Poppins', sans-serif;
  height: 100vh;
  width: 100vw;
  overflow: hidden;
  background: linear-gradient(to top, #a3d9a5 0%, #dff9fb 70%, #ffffff 100%);
  color: #054d1d;
  display: flex;
  justify-content: center;
  align-items: center;
}

.sun {
  position: absolute;
  top: 60px;
  right: 60px;
  width: 120px;
  height: 120px;
  background: radial-gradient(circle, #FFD700, #FFA500);
  border-radius: 50%;
  box-shadow: 0 0 100px #FFD700;
  animation: rotateSun 30s linear infinite;
}
@keyframes rotateSun {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.dashboard {
  display: grid;
  grid-template-columns: repeat(2, 280px);
  grid-template-rows: repeat(2, 250px);
  gap: 25px;
  z-index: 10;
  position: relative;
}

.card {
  background: rgba(255,255,255,0.85);
  border-radius: 20px;
  padding: 25px;
  text-align: center;
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  backdrop-filter: blur(8px);
  transition: transform 0.3s, box-shadow 0.3s;
  position: relative;
}
.card:hover {
  transform: scale(1.05);
  box-shadow: 0 15px 35px rgba(0,0,0,0.25);
}
.card h2 {
  font-size: 1.5rem;
  color: #006400;
  margin-bottom: 12px;
}
.card p {
  font-size: 1.6rem;
  font-weight: bold;
  color: #228B22;
  transition: all 0.4s ease;
}

button {
  margin-top: 15px;
  padding: 10px 25px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  font-size: 1rem;
  color: white;
  background: linear-gradient(45deg, #32CD32, #00FF7F);
  transition: all 0.3s;
}
button:hover {
  transform: scale(1.1);
  box-shadow: 0 0 15px #32CD32;
}

.toggle {
  background: linear-gradient(45deg, #007bff, #00bfff);
}

.grass {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 80px;
  background: repeating-linear-gradient(to right, #228B22, #228B22 5px, #32CD32 5px, #32CD32 10px);
  z-index: 5;
}
</style>
</head>
<body>

<div class="sun"></div>
<div class="grass"></div>

<div class="dashboard">
  <div class="card">
    <h2>ðŸŒ¡ Temperature</h2>
    <p id="temp">-- Â°C</p>
  </div>
  <div class="card">
    <h2>ðŸ’§ Humidity</h2>
    <p id="humidity">-- %</p>
  </div>
  <div class="card">
    <h2>ðŸŒ€ Fan</h2>
    <p id="fanStatus">OFF</p>
    <button class="toggle" onclick="toggleFan()">Toggle Manually</button>
  </div>
  <div class="card">
    <h2>ðŸ§  Comfort Index</h2>
    <p id="comfort">--%</p>
    <p id="predictionText" style="font-size:1rem; color:#006400; margin-top:8px;">Analyzing...</p>
  </div>
</div>

<script>
const baseURL = "https://iot.roboninja.in/index.php";
const UID = "VC11";
let fanState = false;
const TEMP_THRESHOLD = 30; // temperature above which fan auto turns on

// Calculate comfort (no ML, pure logic)
function calculateComfort(temp, hum) {
  return Math.max(0, 100 - Math.abs(temp - 25) * 2 - Math.abs(hum - 50) * 0.8);
}

// Update comfort UI
function updateAI(temp, hum) {
  const comfort = calculateComfort(temp, hum).toFixed(1);
  document.getElementById("comfort").innerText = comfort + "%";

  let text = "";
  if (comfort > 85) text = "ðŸŒ¿ Perfectly comfortable!";
  else if (comfort > 65) text = "ðŸŒ¤ Slightly warm but pleasant.";
  else if (comfort > 45) text = "â˜ï¸ Slightly uncomfortable.";
  else text = "ðŸ”¥ Uncomfortable environment!";
  document.getElementById("predictionText").innerText = text;
}

// Send fan control command to IoT cloud
async function setFanState(state) {
  fanState = state;
  document.getElementById("fanStatus").innerText = fanState ? "ON" : "OFF";
  document.getElementById("fanStatus").style.color = fanState ? "#32CD32" : "#ff5555";
  try {
    await fetch(`${baseURL}?action=write&UID=${UID}&D1=${fanState ? 1 : 0}`);
  } catch (err) {
    console.error("Error writing fan state:", err);
  }
}

// Manual toggle button
function toggleFan() {
  setFanState(!fanState);
}

// Fetch temperature and humidity data
async function fetchSensorData() {
  try {
    const res = await fetch(`${baseURL}?action=read_all&UID=${UID}`);
    const data = await res.json();

    const temp = parseFloat(data.Temperature || 0);
    const hum = parseFloat(data.Humidity || 0);

    document.getElementById("temp").innerText = temp.toFixed(1) + " Â°C";
    document.getElementById("humidity").innerText = hum.toFixed(1) + " %";

    // Auto fan control logic
    if (temp > TEMP_THRESHOLD && !fanState) {
      setFanState(true); // auto ON
      console.log("Fan turned ON automatically due to high temp!");
    } else if (temp <= TEMP_THRESHOLD && fanState) {
      setFanState(false); // auto OFF
      console.log("Fan turned OFF as temp is normal.");
    }

    updateAI(temp, hum);
  } catch (err) {
    console.error("Error fetching sensor data:", err);
  }
}

// Update every 2 seconds
setInterval(fetchSensorData, 2000);
fetchSensorData();
</script>

</body>
</html>
